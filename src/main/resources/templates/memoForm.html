<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Emoji:wght@400&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
    <title>メモ新規作成</title>
    <style>
        /* モーダル全体のスタイル */
        .modal {
            display: none; /* 初期状態は非表示 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 背景を半透明に */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 400px;
        }

        .modal-message {
            margin-bottom: 20px;
            font-family: 'Noto Serif', serif;
            font-size: 16px;
            color: #333;
        }

        .modal-button {
            padding: 10px 20px;
            background-color: #808080;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .modal-button:hover {
            background-color: #666666;
        }

        /* ヘッダーのフェードイン・フェードアウト */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #e9e9e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;

            /* 初期状態: 非表示（透明） */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        header.show {
            opacity: 1; /* 表示 */
            visibility: visible;
        }
    </style>
</head>
<body>

<header id="mainHeader">
    <div class="title-link emoji">
        <a th:href="@{/}">🏠</a>
    </div>

    <!-- 文字数カウント -->
    <div class="header-counter">
        文字数: <span id="charCount">0</span>
    </div>

    <!-- 投稿ボタン -->
    <div class="header-create">
        <button type="submit" form="memoForm" class="emoji">📥</button>
    </div>
</header>

<div class="form">
    <form id="memoForm" th:action="@{/memos}" th:method="post" th:object="${memoForm}">
        <div class="FlexTextarea">
            <div class="FlexTextarea__dummy" aria-hidden="true"></div>
            <textarea id="content" class="FlexTextarea__textarea" th:field="*{content}" placeholder="本文を入力してください"></textarea>
        </div>
    </form>
</div>

<!-- モーダル -->
<div id="customModal" class="modal">
    <div class="modal-content">
        <div class="modal-message">
            本文を入力してから保存してください。<br>
            何も入力しない場合は、ホームに戻りましょう。
        </div>
        <button id="modalClose" class="modal-button">閉じる</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const contentField = document.getElementById("content");
        const memoForm = document.getElementById("memoForm");
        const modal = document.getElementById("customModal");
        const modalClose = document.getElementById("modalClose");
        const charCount = document.getElementById("charCount");
        const header = document.getElementById("mainHeader");

        // フォーム送信時のバリデーション
        memoForm.addEventListener("submit", function (event) {
            if (!contentField.value.trim()) {
                event.preventDefault(); // フォーム送信を中止
                modal.style.display = "flex"; // モーダルを表示
            }
        });

        // モーダル閉じるボタンの動作
        modalClose.addEventListener("click", function () {
            modal.style.display = "none"; // モーダルを非表示
            contentField.focus(); // 本文入力欄にフォーカス
        });

        // 自動サイズ調整機能（FlexTextarea）
        function flexTextarea(el) {
            const dummy = el.querySelector('.FlexTextarea__dummy');
            const textarea = el.querySelector('.FlexTextarea__textarea');

            textarea.addEventListener('input', (e) => {
                dummy.textContent = e.target.value + '\u200b'; // 入力内容に基づき高さ調整
                charCount.textContent = textarea.value.length; // 文字数を更新
            });

            // 初期化時にも高さと文字数を設定
            dummy.textContent = textarea.value + '\u200b';
            charCount.textContent = textarea.value.length;
        }

        document.querySelectorAll('.FlexTextarea').forEach(flexTextarea);

        // マウスが画面上部にある場合にヘッダーを表示
        document.addEventListener("mousemove", (event) => {
            if (event.clientY < 50) {
                header.classList.add("show");
            } else {
                header.classList.remove("show");
            }
        });
    });
</script>

</body>
</html>