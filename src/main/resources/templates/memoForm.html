<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Emoji:wght@400&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
    <title>ãƒ¡ãƒ¢æ–°è¦ä½œæˆ</title>
    <style>
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* èƒŒæ™¯ã‚’åŠé€æ˜ã« */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 400px;
        }

        .modal-message {
            margin-bottom: 20px;
            font-family: 'Noto Serif', serif;
            font-size: 16px;
            color: #333;
        }

        .modal-button {
            padding: 10px 20px;
            background-color: #808080;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .modal-button:hover {
            background-color: #666666;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #e9e9e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;

            /* åˆæœŸçŠ¶æ…‹: éè¡¨ç¤ºï¼ˆé€æ˜ï¼‰ */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        header.show {
            opacity: 1; /* è¡¨ç¤º */
            visibility: visible;
        }
    </style>
</head>
<body>

<header id="mainHeader">
    <div class="title-link emoji">
        <a th:href="@{/}">ğŸ </a>
    </div>

    <!-- æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ -->
    <div class="header-counter">
        æ–‡å­—æ•°: <span id="charCount">0</span>
    </div>

    <!-- æŠ•ç¨¿ãƒœã‚¿ãƒ³ -->
    <div class="header-create">
        <button type="submit" form="memoForm" class="emoji">ğŸ“¥</button>
    </div>
</header>

<div class="form">
    <form id="memoForm" th:action="@{/memos}" th:method="post" th:object="${memoForm}">
        <div class="FlexTextarea">
            <div class="FlexTextarea__dummy" aria-hidden="true"></div>
            <textarea id="content" class="FlexTextarea__textarea" th:field="*{content}" placeholder="æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        </div>
    </form>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="customModal" class="modal">
    <div class="modal-content">
        <div class="modal-message">
            æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰ä¿å­˜ã—ã¦ãã ã•ã„ã€‚<br>
            ä½•ã‚‚å…¥åŠ›ã—ãªã„å ´åˆã¯ã€ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã—ã‚‡ã†ã€‚
        </div>
        <button id="modalClose" class="modal-button">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const contentField = document.getElementById("content");
        const memoForm = document.getElementById("memoForm");
        const modal = document.getElementById("customModal");
        const modalClose = document.getElementById("modalClose");
        const charCount = document.getElementById("charCount");
        const header = document.getElementById("mainHeader");

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        memoForm.addEventListener("submit", function (event) {
            if (!contentField.value.trim()) {
                event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ä¸­æ­¢
                modal.style.display = "flex"; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            }
        });

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®å‹•ä½œ
        modalClose.addEventListener("click", function () {
            modal.style.display = "none"; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’éè¡¨ç¤º
            contentField.focus(); // æœ¬æ–‡å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        });

        // è‡ªå‹•ã‚µã‚¤ã‚ºèª¿æ•´æ©Ÿèƒ½ï¼ˆFlexTextareaï¼‰
        function flexTextarea(el) {
            const dummy = el.querySelector('.FlexTextarea__dummy');
            const textarea = el.querySelector('.FlexTextarea__textarea');

            textarea.addEventListener('input', (e) => {
                dummy.textContent = e.target.value + '\u200b'; // å…¥åŠ›å†…å®¹ã«åŸºã¥ãé«˜ã•èª¿æ•´
                charCount.textContent = textarea.value.length; // æ–‡å­—æ•°ã‚’æ›´æ–°
            });

            // åˆæœŸåŒ–æ™‚ã«ã‚‚é«˜ã•ã¨æ–‡å­—æ•°ã‚’è¨­å®š
            dummy.textContent = textarea.value + '\u200b';
            charCount.textContent = textarea.value.length;
        }

        document.querySelectorAll('.FlexTextarea').forEach(flexTextarea);

        // ãƒã‚¦ã‚¹ãŒç”»é¢ä¸Šéƒ¨ã«ã‚ã‚‹å ´åˆã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤º
        document.addEventListener("mousemove", (event) => {
            if (event.clientY < 50) {
                header.classList.add("show");
            } else {
                header.classList.remove("show");
            }
        });
    });
</script>

</body>
</html>